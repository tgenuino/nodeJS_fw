var loader = function(base) {
    var fs = require('fs'),
        path = require('path'),
        bundle = {},
        mod,
        stats,
        filePath;

        fs.readdirSync(base).forEach(function(filename) {
            filePath = base + '/' + filename;
            stats = fs.statSync(filePath);
            
            if (stats.isDirectory()) {
                mod = filename;
                bundle[mod] = loader(filePath);
            } else {
                if (path.extname(filename) == '.js' &&
                    path.resolve(filename) != __filename) {
                        mod = filename.replace('.js', '');
                        bundle[mod] = require(path.resolve(filePath));
                }
            }
        });

    return bundle;
};

module.exports = loader;